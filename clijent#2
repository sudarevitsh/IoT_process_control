#include <ESP8266WiFi.h>
#include <ESP8266HTTPClient.h>

const char* ssid = "Boban";
const char* password = "12345678";

const uint16_t port = 80;

IPAddress host (8,8,8,8);
String host_str = "8.8.8.8";

WiFiClient client; 
String route = "/client2/";
String id = "2";

float temp;
float humi;
float moist;

const int reg_temperature = 14; //GPIO14 = D5
const int reg_humidity = 12; //GPIO12 = D6
const int reg_moisture = 13; //GPIO13 = D7

void setup(){

  Serial.begin(115200);

  pinMode(LED_BUILTIN, OUTPUT);
  pinMode(reg_temperature, OUTPUT);
  pinMode(reg_humidity, OUTPUT);
  pinMode(reg_moisture, OUTPUT);
  
  WiFi.mode(WIFI_STA);
  WiFi.begin(ssid, password);
  
  while(WiFi.status() != WL_CONNECTED){
    digitalWrite(LED_BUILTIN, LOW);
    delay(200);
    digitalWrite(LED_BUILTIN, HIGH);
    delay(200);
  }  
}

void loop(){

  WiFiClient client;

  temp = random(10,50);
  humi = random(10,80);
  moist = random(5,90);

  /*if (client.connect(host_str, port)){
    digitalWrite(LED_BUILTIN, LOW);
    delay(1000);
    digitalWrite(LED_BUILTIN, HIGH);    
  }*/
  client.connect(host_str, port);

  String request =String("/client2/?client_id=" + id + "&temperature=" + String(temp) + "&humidity=" + String(humi) + "&moist=" + String(moist));
  client.print(String("GET " + request + " HTTP/1.1\r\n" + "Host: " + host_str + "\r\n" + "Connection: close\r\n\r\n"));

  Serial.println(request); //Serial.print(httpCode); Serial.println(response);
  
  delay(1500);  
  
  if (temp < 5){
    digitalWrite(reg_temperature, HIGH);
  }
  
  if (humi < 50){
    digitalWrite(reg_humidity, HIGH);
  }
  
  if (moist < 40){
    digitalWrite(reg_moisture, HIGH);
  }
   
}
