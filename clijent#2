#include <ESP8266WiFi.h>
#include <ESP8266HTTPClient.h>

const char* ssid = "Boban";
const char* password = "12345678";

const uint16_t port = 80;

IPAddress host (8,8,8,8);
String host_str = "8.8.8.8";

WiFiClient client; 
String route = "/client2/";
String id = "2";

float temp;
float humi;
float moist;

const int reg_temperature = 14; //GPIO14 = D5
const int reg_humidity = 12; //GPIO12 = D6
const int reg_moisture = 13; //GPIO13 = D7

void setup(){

  Serial.begin(115200);

  pinMode(LED_BUILTIN, OUTPUT);
  pinMode(reg_temperature, OUTPUT);
  pinMode(reg_humidity, OUTPUT);
  pinMode(reg_moisture, OUTPUT);
  
  WiFi.mode(WIFI_STA);
  WiFi.begin(ssid, password);
  
  while(WiFi.status() != WL_CONNECTED){
    digitalWrite(LED_BUILTIN, LOW);
    delay(200);
    digitalWrite(LED_BUILTIN, HIGH);
    delay(200);
  }
  
  if (WiFi.status() == WL_CONNECTED){
    digitalWrite(LED_BUILTIN, HIGH);
  }

  
}

void loop(){

  temp = random(10,50);
  humi = random(10,80);
  moist = random(5,90);

  /*if (client.connect(host_str, port)){
    digitalWrite(LED_BUILTIN, LOW);
    delay(1000);
    digitalWrite(LED_BUILTIN, HIGH);    
  }*/
   
  String url = host_str + route;
  String data = "?client_id=" + id + "?temperature=" + String(temp);
      data += "?humidity=" + String(humi) + "?moist=" + String(moist);
  String msg = url + data;
  HTTPClient http;
  http.begin(msg);
  int httpCode = http.GET();
  String response = http.getString();

  Serial.print(url); Serial.print(httpCode); Serial.println(response);
  http.end();

  delay(15000);
      
  /*client.print ("GET ");
  client.print (url);
  client.print (" HTTP/1.1\r\n");
  client.print ("Host: ");
  client.print (host_str);
  client.print ("\r\n");
  client.print ("Content-Type: text/plain");
  client.print ("Connection: close\r\n\r\n");
  
  while (client.available()){
    String line = client.readStringUntil('\r'); Serial.print(line);
  }
  Serial.println();
  Serial.println("closing connection"); */
  
  
  
  if (temp < 5){
    digitalWrite(reg_temperature, HIGH);
  }
  
  if (humi < 50){
    digitalWrite(reg_humidity, HIGH);
  }
  
  if (moist < 40){
    digitalWrite(reg_moisture, HIGH);
  }
   
}
